{"version":3,"sources":["index.js"],"names":["log","logger","argv","minimist","process","slice","info","loadFileConfig","let","promise","file","readFileAsync","path","resolve","cwd","then","data","JSON","parse","Promise","config","connection","Object","assign","protocol","env","RCLI_PROTOCOL","RCLI_ENV","host","RCLI_HOST","username","RCLI_USERNAME","password","RCLI_PASSWORD","actionName","_","actionTask","getServiceByPath","service","restart","container","getContainerByHostAndName","reject","console","err"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAMA,MAAMC,sBAAO,oBAAPA,CAAZ;AACA,IAAMC,OAAOC,wBAASC,QAAQF,IAARE,CAAaC,KAAbD,CAAmB,CAAnBA,CAATD,CAAb;;AAEAH,IAAIM,IAAJN,CAAS,MAATA,EAAiBE,IAAjBF;;AAEA,SAASO,cAAT,GAA0B;AACxBC,MAAIC,gBAAJD;AACA,MAAGN,KAAKQ,IAAR,EAAc;AACZ,WAAOC,uBAAcC,eAAKC,OAALD,CAAaR,QAAQU,GAARV,EAAbQ,EAA4BV,KAAKQ,IAAjCE,CAAdD,EACJI,IADIJ,CACC,UAACK,IAAD;AAAA,aAAUC,KAAKC,KAALD,CAAWD,IAAXC,CAAV;AAAA,KADDN,CAAP;AAEF;AACA,SAAOQ,QAAQN,OAARM,CAAgB,EAAhBA,CAAP;AACF;;AAEAZ,iBAAiBQ,IAAjBR,CAAsB,UAACa,MAAD,EAAY;AAChC,MAAMC,aAAaC,OAAOC,MAAPD,CAAc;AAC/BE,cAAUpB,QAAQqB,GAARrB,CAAYsB,aADS;AAE/BD,SAAKrB,QAAQqB,GAARrB,CAAYuB,QAFc;AAG/BC,UAAMxB,QAAQqB,GAARrB,CAAYyB,SAHa;AAI/BC,cAAU1B,QAAQqB,GAARrB,CAAY2B,aAJS;AAK/BC,cAAU5B,QAAQqB,GAARrB,CAAY6B;AALS,GAAdX,EAMhBF,MANgBE,EAMRpB,IANQoB,CAAnB;AAOA,MAAMG,MAAM,4BAAgBJ,UAAhB,EAA4BA,WAAWI,GAAvC,CAAZ;AACA,MAAMS,aAAahC,KAAKiC,CAALjC,CAAO,CAAPA,CAAnB;AACA,MAAMkC,aAAalC,KAAKiC,CAALjC,CAAO,CAAPA,CAAnB;AACA,UAAOgC,UAAP;AACE,SAAK,SAAL;AACE,cAAOE,UAAP;AACE,aAAK,SAAL;AACE,cAAMxB,QAAOV,KAAKiC,CAALjC,CAAO,CAAPA,CAAb;AACA,iBAAOuB,IAAIY,gBAAJZ,CAAqBb,KAArBa,EACLV,IADKU,CACA,UAACa,OAAD;AAAA,mBAAaA,QAAQC,OAARD,EAAb;AAAA,WADAb,CAAP;AAHJ;AAMA;AACF,SAAK,WAAL;AACE,cAAOW,UAAP;AACE,aAAK,SAAL;AACE,cAAMR,OAAO1B,KAAKiC,CAALjC,CAAO,CAAPA,CAAb;AACA,cAAMsC,YAAYtC,KAAKiC,CAALjC,CAAO,CAAPA,CAAlB;AACA,iBAAOuB,IAAIgB,yBAAJhB,CAA8BG,IAA9BH,EAAoCe,SAApCf,EACLV,IADKU,CACA,UAACe,SAAD;AAAA,mBAAeA,UAAUD,OAAVC,EAAf;AAAA,WADAf,CAAP;AAJJ;AAOA;AAjBJ;AAmBA,SAAON,QAAQuB,MAARvB,CAAe,mBAAfA,CAAP;AACD,CA/BDZ,EA+BGQ,IA/BHR,CA+BQ,YAAM;AACZoC,UAAQ3C,GAAR2C,CAAY,qCAAZA;AACD,CAjCDpC,EAiCG,UAACqC,GAAD,EAAS;AACVD,UAAQ3C,GAAR2C,CAAY,uBAAZA,EAAqCC,GAArCD;AACD,CAnCDpC","file":"index.js","sourcesContent":["import {readFileAsync} from \"utils/fs\";\r\nimport path from \"path\";\r\nimport minimist from \"minimist\";\r\nimport {Environment} from \"rancher-lib\";\r\nimport logger from \"utils/logger\";\r\n\r\nconst log = logger(\"rancher-cli:index:\");\r\nconst argv = minimist(process.argv.slice(2));\r\n\r\nlog.info(\"args\", argv);\r\n\r\nfunction loadFileConfig() {\r\n  let promise;\r\n  if(argv.file) {\r\n    return readFileAsync(path.resolve(process.cwd(), argv.file))\r\n      .then((data) => JSON.parse(data))\r\n  } \r\n  return Promise.resolve({});\r\n}\r\n\r\nloadFileConfig().then((config) => {\r\n  const connection = Object.assign({\r\n    protocol: process.env.RCLI_PROTOCOL,\r\n    env: process.env.RCLI_ENV,\r\n    host: process.env.RCLI_HOST,\r\n    username: process.env.RCLI_USERNAME,\r\n    password: process.env.RCLI_PASSWORD,\r\n  }, config, argv);\r\n  const env = new Environment(connection, connection.env);\r\n  const actionName = argv._[0];\r\n  const actionTask = argv._[1];\r\n  switch(actionName) {\r\n    case \"service\":\r\n      switch(actionTask) {\r\n        case \"restart\":\r\n          const path = argv._[2];\r\n          return env.getServiceByPath(path)\r\n           .then((service) => service.restart());\r\n      }\r\n      break;\r\n    case \"container\":\r\n      switch(actionTask) {\r\n        case \"restart\":\r\n          const host = argv._[2];\r\n          const container = argv._[3];\r\n          return env.getContainerByHostAndName(host, container)\r\n           .then((container) => container.restart());\r\n      }\r\n      break;\r\n  }\r\n  return Promise.reject(\"Command not found\");\r\n}).then(() => {\r\n  console.log(\"Task has been completed successfuly\");\r\n}, (err) => {\r\n  console.log(\"An error has occurred\", err);\r\n});\r\n"]}